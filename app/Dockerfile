FROM node:18-alpine3.15

WORKDIR /usr/src/app

ARG MONGO_DB_DATABASE_URL
ARG AUTH0_BASE_URL 
ARG AUTH0_CLIENT_SECRET 
ARG AUTH0_CLIENT_ID 
ARG AUTH0_ISSUER_BASE_URL
ARG AUTH0_SECRET 
ARG GCP_BUCKET_NAME
ARG GCP_CLIENT_EMAIL
ARG GCP_CLIENT_ID 
ARG GCP_PRIVATE_KEY
ARG GCP_PROJECT_ID 
ARG OPEN_AI_API_KEY
ARG OPEN_AI_BASE_URL
ARG STRIPE_SECRET_KEY

RUN echo $MONGO_DB_DATABASE_URL

ENV MONGO_DB_DATABASE_URL = $MONGO_DB_DATABASE_URL
ENV AUTH0_BASE_URL = $AUTH0_BASE_URL
ENV AUTH0_CLIENT_SECRET = $AUTH0_CLIENT_SECRET
ENV AUTH0_CLIENT_ID = $AUTH0_CLIENT_ID
ENV AUTH0_ISSUER_BASE_URL = $AUTH0_ISSUER_BASE_URL
ENV AUTH0_SECRET = $AUTH0_SECRET
ENV GCP_BUCKET_NAME = $GCP_BUCKET_NAME
ENV GCP_CLIENT_EMAIL = $GCP_CLIENT_EMAIL
ENV GCP_CLIENT_ID = $GCP_CLIENT_ID
ENV GCP_PRIVATE_KEY = $GCP_PRIVATE_KEY
ENV GCP_PROJECT_ID = $GCP_PROJECT_ID
ENV OPEN_AI_API_KEY = $OPEN_AI_API_KEY
ENV OPEN_AI_BASE_URL = $OPEN_AI_BASE_URL
ENV STRIPE_SECRET_KEY = $STRIPE_SECRET_KEY

COPY . .

RUN yarn install
RUN yarn create-env
RUN yarn run build

EXPOSE 80

CMD [ "yarn", "start" ]