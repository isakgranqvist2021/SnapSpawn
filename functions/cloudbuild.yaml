options:
  logging: CLOUD_LOGGING_ONLY
  env:
    - 'NODE_ENV=$_NODE_ENV'
    - 'MONGO_DB_DATABASE_URL=$_MONGO_DB_DATABASE_URL'
    - 'STRIPE_WEBHOOK_SECRET=$_STRIPE_WEBHOOK_SECRET'
    - 'STRIPE_SECRET_KEY=$_STRIPE_SECRET_KEY'

timeout: '1600s'

steps:
  - name: node:18.12.1
    dir: functions
    entrypoint: yarn
    id: install

  - name: node:18.12.1
    args: ['create-env']
    dir: functions
    entrypoint: yarn
    id: create-env
    waitFor: ['install']

  - name: node:18.12.1
    args: ['build']
    dir: functions
    entrypoint: yarn
    waitFor: ['create-env']
